/\*\*

- Generated by: GPT-5 Codex
- Last modified: 2025-10-23 15:32:41 UTC
-
- This code was AI-generated and may require human review and testing.
  \*/

# App Directory Guidance

## Scope

- This guide covers work inside `app/components`, `app/pages`, `app/helpers`, `app/entrypoints`, `app/types`, and other shared frontend/rails directories under `app/`.
- Add more granular `AGENTS.md` files inside subfolders (e.g., `app/components/AGENTS.md`) when a sub-area needs overrides.

## Frontend Execution Checklist

- Prefer inline logic over `useMemo`/`useCallback` unless a measured performance issue requires memoization.
- Declare all functions—including exports—as arrow expressions (`const fn = () => {}`).
- When array access is guaranteed, assert non-null with `arr[index]!` so TypeScript understands the invariant.
- Leverage auto-imported globals; check `typings/generated/auto-import.d.ts` before adding manual imports.

## Component & Page Patterns

```tsx
import { Button } from "@mantine/core";
import IconName from "~icons/heroicons/icon-name-20-solid";
import { type ComponentProps } from "~/types";
import classes from "./ComponentName.module.css";

export interface ComponentNameProps {
  // props
}

const ComponentName: FC<ComponentNameProps> = ({ prop }) => {
  return <div className={classes.wrapper}>{prop}</div>;
};

ComponentName.layout = page => <SomeLayout>{page}</SomeLayout>;

export default ComponentName;
```

- Pages should use `PageComponent<PropsType>` and extend `SharedPageProps` when applicable.

## Data Fetching & Mutations

```tsx
const { data, error, mutate } = useRouteSWR<ResponseType>(
  routes.endpoint.path(),
  {
    descriptor: "descriptive name",
    keepPreviousData: true,
  },
);

const { trigger } = useRouteMutation<ResponseType>(routes.endpoint.path(), {
  descriptor: "action description",
});
```

- Choose descriptive `descriptor` strings; they appear in logs and debugging tools.

## Navigation & PWA

- Use `const { url: pageUrl } = usePage();` inside pages; helpers may use `url` when context is singular.
- Preserve `pwa_scope` and other query params when redirecting—`queryParamsFromPath(pageUrl)` helps when passing `{ query }`.
- Prefer `PWAScopedLink` for internal navigation to keep scope consistent.
- Android devices may not report as Chrome; treat `result.browser.is("Chrome") || result.os.is("Android")` as PWA-install capable.

## Auth & Real-Time Hooks

- `useCurrentUser()` and `useCurrentFriend()` expose the two authentication paths.
- Gate admin-only UI with `useIsAdmin()`.
- Real-time: `useSubscription` for ActionCable, `useWebPush` for notifications, and let SWR revalidate on window focus instead of manual refreshes.

## Rails Models & Sorbet

- When editing `app/models`, run `bin/tapioca dsl` after changing associations or scopes so Sorbet gains updated RBI files.
- The command needs database access; rerun once the DB is available if it fails during sandboxed work.
