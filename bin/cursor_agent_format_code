#!/usr/bin/env bash

# Format code after making changes
# Usage: bin/cursor_agent_format_code

set -e

echo "üîß Setting up environment..."

# Setup Node.js
export PATH="$HOME/.nodenv/bin:$PATH"
if command -v nodenv >/dev/null 2>&1; then
  eval "$(nodenv init -)"
fi

# Check if package.json exists
if [ ! -f "package.json" ]; then
  echo "‚ùå No package.json found. This script requires a Node.js project."
  exit 1
fi

echo "‚ú® Formatting with prettier..."
npm exec -- prettier --write '**/*.{js,jsx,ts,tsx,css,md,html,json,yaml,yml}' 2>/dev/null || echo "‚ö†Ô∏è Prettier failed or not installed"

echo "üßπ Running ESLint auto-fix..."
npm exec -- eslint --fix '**/*.{js,jsx,ts,tsx}' 2>/dev/null || echo "‚ö†Ô∏è ESLint failed or not installed"

echo "üöÄ Running lefthook..."
npm exec -- lefthook run fix 2>/dev/null || echo "‚ö†Ô∏è Lefthook failed or not installed"

echo "‚úÖ Formatting complete!"